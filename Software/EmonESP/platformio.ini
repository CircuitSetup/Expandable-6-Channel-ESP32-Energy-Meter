; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = emonesp-nodemcu32s, emonesp_spiffs
data_dir = src/data

[common]
version = -DBUILD_TAG=2.6
platform = espressif32
framework = arduino
lib_deps = 
	PubSubClient@2.6
	ESP Async WebServer@1.2.3
	AsyncTCP@1.1.1
	circuitsetup/ATM90E32
monitor_speed = 115200
board_build.flash_mode = dout
board_build.f_cpu = 80000000L
upload_port = /dev/cu.usbserial-0001
upload_speed = 921600
upload_resetmethod = nodemcu

[env:emonesp-nodemcu32s]
board = nodemcu-32s
platform = ${common.platform}
framework = ${common.framework}
lib_deps = 
	${common.lib_deps}
	arduino-libraries/NTPClient@^3.1.0
	jeremypoulter/ConfigJson@^0.0.4
	jeremypoulter/StreamSpy@^0.0.2
	jeremypoulter/ESPAL@^0.0.2
	bblanchon/ArduinoJson@^6.17.2
build_flags = 
	${common.version}
	-DCS_PLATFORM=CS_P_ESP32
	-DWIFI_LED=LED_BUILTIN
	-DENABLE_DEBUG
	-DCORE_DEBUG_LEVEL=5
monitor_speed = ${common.monitor_speed}
board_build.flash_mode = ${common.board_build.flash_mode}
board_build.f_cpu = ${common.board_build.f_cpu}
upload_port = ${common.upload_port}
upload_speed = ${common.upload_speed}
upload_resetmethod = ${common.upload_resetmethod}

[env:emonesp_spiffs]
board = nodemcu-32s
platform = ${common.platform}
framework = ${common.framework}
upload_port = ${common.upload_port}
upload_speed = ${common.upload_speed}
upload_resetmethod = ${common.upload_resetmethod}
targets = buildfs, uploadfs
lib_deps = 
	arduino-libraries/NTPClient@^3.1.0
	jeremypoulter/ConfigJson@^0.0.4
	jeremypoulter/StreamSpy@^0.0.2
	jeremypoulter/ESPAL@^0.0.2
	bblanchon/ArduinoJson@^6.17.2

[env:emonesp_deploy]
extends = env:emonesp-nodemcu32
src_build_flags = !(test -z $TRAVIS_TAG && echo '${common.version}') || echo '-DBUILD_TAG='$TRAVIS_TAG
lib_deps = 
	arduino-libraries/NTPClient@^3.1.0
	jeremypoulter/ConfigJson@^0.0.4
	jeremypoulter/StreamSpy@^0.0.2
	jeremypoulter/ESPAL@^0.0.2
	bblanchon/ArduinoJson@^6.17.2

[env:emonesp_staging]
extends = env:emonesp-nodemcu32
platform_packages = 
	framework-arduinoespressif32 @ https://github.com/espressif/arduino-esp32.git
lib_deps = 
	https://github.com/knolleary/pubsubclient,
	https://github.com/me-no-dev/ESPAsyncWebServer.git,
	https://github.com/me-no-dev/AsyncTCP.git,
	https://github.com/CircuitSetup/ATM90E32.git
	arduino-libraries/NTPClient@^3.1.0
	jeremypoulter/ConfigJson@^0.0.4
	jeremypoulter/StreamSpy@^0.0.2
	jeremypoulter/ESPAL@^0.0.2
	bblanchon/ArduinoJson@^6.17.2
